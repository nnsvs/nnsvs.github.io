<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to train post-filters &mdash; nnsvs 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=01f34227"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            nnsvs
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebooks/Demos.html">NNSVS demos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Getting started with recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_choose_model.html">How to choose model</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_models.html">Defining your custom model</a></li>
<li class="toctree-l1"><a class="reference internal" href="devdocs.html">Development guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="update_guide.html">Update guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="optuna.html">Hyperparameter optimization with Optuna</a></li>
<li class="toctree-l1"><a class="reference internal" href="train_vocoders.html">How to train neural vocoders with ParallelWaveGAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="train_usfgan.html">How to train uSFGAN/SiFiGAN vocoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="enunu2nnsvs.html">How to convert ENUNU models to NNSVS’ ones</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of NNSVS’s SVS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/base.html">nnsvs.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/model.html">nnsvs.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/acoustic_models.html">nnsvs.acoustic_models</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/postfilters.html">nnsvs.postfilters</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/discriminators.html">nnsvs.discriminators</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/pretrained.html">nnsvs.pretrained</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/svs.html">nnsvs.svs</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/dsp.html">nnsvs.dsp</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/gen.html">nnsvs.gen</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/io.html">nnsvs.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/mdn.html">nnsvs.mdn</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/pitch.html">nnsvs.pitch</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/multistream.html">nnsvs.multistream</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/util.html">nnsvs.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/train_util.html">nnsvs.train_util</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="links.html">Useful links</a></li>
<li class="toctree-l1"><a class="reference internal" href="papers.html">Papers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change log</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">nnsvs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to train post-filters</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/train_postfilters.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-train-post-filters">
<h1>How to train post-filters<a class="headerlink" href="#how-to-train-post-filters" title="Link to this heading"></a></h1>
<p>Please check <a class="reference internal" href="recipes.html"><span class="doc">Getting started with recipes</span></a> and <a class="reference internal" href="overview.html"><span class="doc">Overview of NNSVS’s SVS</span></a> first.</p>
<p>NNSVS v0.0.3 and later supports an optional trainable post-filter to enhance the acoustic model’s prediction.
This page summarizes how to train post-filters.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>As of 2022/10/15, I concluded that GV-post filter works better than trainalbe post-filters in most cases.
Please consider using GV-post filter insteaad.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The contents in this page is based on <code class="docutils literal notranslate"><span class="pre">recipes/conf/spsvs/run_common_steps_dev.sh</span></code>.
Also, before you make your custom recipes, it is recommenced to start with a test recipe <code class="docutils literal notranslate"><span class="pre">recipes/nit-song070/dev-test</span></code>.</p>
</div>
<section id="pre-requisites">
<h2>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Link to this heading"></a></h2>
<section id="input-output-of-a-post-filter">
<h3>Input/output of a post-filter<a class="headerlink" href="#input-output-of-a-post-filter" title="Link to this heading"></a></h3>
<p>Input and output of a post-filter are as follows:</p>
<ul class="simple">
<li><p>Input: acoustic features predicted by an acoustic model</p></li>
<li><p>Output: enhanced acoustic features</p></li>
</ul>
<p>Note that post-filters do not use delta and delta-delta features.
If your acoustic model’s output contains delta and delta-delta features, the parameter generation algorithm (a.k.a. MLPG) is performed to prepare input/output features for post-filters.</p>
</section>
<section id="you-must-train-an-acoustic-model-first">
<h3>You must train an acoustic model first<a class="headerlink" href="#you-must-train-an-acoustic-model-first" title="Link to this heading"></a></h3>
<p>You must train an acoustic model first since the input of a post-filter depends the output of an acoustic model.
Furthermore, please be aware that you need to re-train a post-filter whenever you re-train your acoustic model.
Therefore, it is highly recommended to train a good acoustic model before training a post-filter.</p>
</section>
<section id="train-a-good-acoustic-model-first">
<h3>Train a good acoustic model first<a class="headerlink" href="#train-a-good-acoustic-model-first" title="Link to this heading"></a></h3>
<p>It is better to train a good acoustic model. This is because the post-filter is trained on the features predicted by the acoustic model.
If the acoustic model’s prediction is not accurate enough, the post-filter is likely to have a bad performance.</p>
<p>In addition to the steps described in <a class="reference internal" href="recipes.html"><span class="doc">Getting started with recipes</span></a>,  the following are the steps related to post-filters.</p>
</section>
</section>
<section id="stage-7-prepare-features-for-post-filter">
<h2>Stage 7: Prepare features for post-filter<a class="headerlink" href="#stage-7-prepare-features-for-post-filter" title="Link to this heading"></a></h2>
<p>Once your acoustic model is ready, you can run the stage 7 to prepare input and output features for training post-filters.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">7</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test
</pre></div>
</div>
<p>After running the above command, you can find the input features for post-filters in the acoustic model’s checkpoint directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree -L 3 exp/yoko/acoustic_test/

exp/yoko/acoustic_test/
├── best_loss.pth
├── config.yaml
├── epoch0002.pth
├── latest.pth
├── model.yaml
├── norm
│   ├── dev
│   │   └── in_postfilter
│   ├── eval
│   │   └── in_postfilter
│   ├── in_postfilter_scaler.joblib
│   └── train_no_dev
│       └── in_postfilter
└── predicted
    └── eval
        └── latest
</pre></div>
</div>
<p>Some notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">norm/*/in_postfilter</span></code> directory contains the input features for post-filters.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">norm/in_postfilter_scaler.joblib</span></code> contains the scaler used to normalize/de-normalize the input features for post-filters.</p></li>
</ul>
<p>As for the output features, you can find them in the <code class="docutils literal notranslate"><span class="pre">dump</span></code> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree -L 4 dump/

dump/
└── yoko
    ├── norm
    │   ├── dev
    │   │   ├── in_acoustic
    │   │   ├── in_duration
    │   │   ├── in_timelag
    │   │   ├── in_vocoder
    │   │   ├── out_acoustic
    │   │   ├── out_duration
    │   │   ├── out_postfilter
    │   │   └── out_timelag
    │   ├── eval
    │   │   ├── in_acoustic
    │   │   ├── in_duration
    │   │   ├── in_timelag
    │   │   ├── in_vocoder
    │   │   ├── out_acoustic
    │   │   ├── out_duration
    │   │   ├── out_postfilter
    │   │   └── out_timelag
    │   ├── in_acoustic_scaler.joblib
    │   ├── in_duration_scaler.joblib
    │   ├── in_timelag_scaler.joblib
    │   ├── in_vocoder_scaler_mean.npy
    │   ├── in_vocoder_scaler_scale.npy
    │   ├── in_vocoder_scaler_var.npy
    │   ├── out_acoustic_scaler.joblib
    │   ├── out_duration_scaler.joblib
    │   ├── out_postfilter_scaler.joblib
    │   ├── out_timelag_scaler.joblib
    │   └── train_no_dev
    │       ├── in_acoustic
    │       ├── in_duration
    │       ├── in_timelag
    │       ├── in_vocoder
    │       ├── out_acoustic
    │       ├── out_duration
    │       ├── out_postfilter
    │       └── out_timelag
    └── org
</pre></div>
</div>
<p>Some notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dump/*/norm/*/out_postfilter</span></code> directory contains the output features for post-filters. Again, remember that these features don’t contain delta and delta-delta features.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dump/*/norm/out_postfilter_scaler.joblib</span></code> contains the scaler used to normalize/de-normalize the output features for post-filters.</p></li>
</ul>
</section>
<section id="stage-8-train-post-filters">
<h2>Stage 8: Train post-filters<a class="headerlink" href="#stage-8-train-post-filters" title="Link to this heading"></a></h2>
<p>Once you generated input/output features, you are ready to train post-filters. The current NNSVS’s post-filter is based on generative adversarial networks (GANs). So you need to train generator and discrimiantor together.</p>
<p>There are number of different ways to train post-filters by NNSVS. However, the following is the recommended way to get the best performance (based on r9y9’s experience):</p>
<ol class="arabic simple">
<li><p>Train a post-filter only for <code class="docutils literal notranslate"><span class="pre">mgc</span></code></p></li>
<li><p>Train a post-filter only for <code class="docutils literal notranslate"><span class="pre">bap</span></code></p></li>
<li><p>Merge the two post-filters into one post-filter</p></li>
</ol>
<p>Pre-tuned config files are stored in <code class="docutils literal notranslate"><span class="pre">recipes/_common/jp_dev_latest/conf/train_postfilter</span></code>.</p>
<section id="train-post-filter-for-mgc">
<h3>Train post-filter for <code class="docutils literal notranslate"><span class="pre">mgc</span></code><a class="headerlink" href="#train-post-filter-for-mgc" title="Link to this heading"></a></h3>
<p>To train a post-filter for <code class="docutils literal notranslate"><span class="pre">mgc</span></code>, you can run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">8</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--postfilter-model<span class="w"> </span>postfilter_mgc_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--postfilter-train<span class="w"> </span>mgc
</pre></div>
</div>
<p>Note that you must specify <code class="docutils literal notranslate"><span class="pre">--postfilter-train</span> <span class="pre">mgc</span></code>. This tells the training script to only use the <code class="docutils literal notranslate"><span class="pre">mgc</span></code> feature stream. Other streams such as <code class="docutils literal notranslate"><span class="pre">lf0</span></code> and <code class="docutils literal notranslate"><span class="pre">bap</span></code> are ignored.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Training a post-filter for <code class="docutils literal notranslate"><span class="pre">mgc</span></code> requires larger amount of GPU VRAM than the normal acoustic model training at the moment. Try using a smaller batch size.</p>
</div>
<p>Once the training is finished, you can find model checkpoints in the <code class="docutils literal notranslate"><span class="pre">exp</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree exp/yoko/postfilter_mgc_test

exp/yoko/postfilter_mgc_test
├── best_loss.pth
├── best_loss_D.pth
├── config.yaml
├── epoch0002.pth
├── epoch0002_D.pth
├── latest.pth
├── latest_D.pth
└── model.yaml
</pre></div>
</div>
<p>Some notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*_D.pth</span></code> is the model checkpoint for the discriminator. D stands for discriminators.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model.yaml</span></code> includes configs for both generator and discrimiantor.</p></li>
</ul>
</section>
<section id="train-post-filter-for-bap">
<h3>Train post-filter for <code class="docutils literal notranslate"><span class="pre">bap</span></code><a class="headerlink" href="#train-post-filter-for-bap" title="Link to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">8</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--postfilter-model<span class="w"> </span>postfilter_bap<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--postfilter-train<span class="w"> </span>bap
</pre></div>
</div>
<p>Note that you must specify <code class="docutils literal notranslate"><span class="pre">--postfilter-train</span> <span class="pre">bap</span></code>. This tells the training script to only use the <code class="docutils literal notranslate"><span class="pre">bap</span></code> feature stream.</p>
</section>
<section id="merge-the-two-post-filters">
<h3>Merge the two post-filters<a class="headerlink" href="#merge-the-two-post-filters" title="Link to this heading"></a></h3>
<p>This step is not included in the recipe. So you need to manually run the following command to merge the two post-filters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">../../../</span><span class="n">utils</span><span class="o">/</span><span class="n">merge_postfilters</span><span class="o">.</span><span class="n">py</span> <span class="n">exp</span><span class="o">/</span><span class="n">yoko</span><span class="o">/</span><span class="n">postfilter_mgc_test</span><span class="o">/</span><span class="n">latest</span><span class="o">.</span><span class="n">pth</span> \
    <span class="n">exp</span><span class="o">/</span><span class="n">yoko</span><span class="o">/</span><span class="n">postfilter_bap_test</span><span class="o">/</span><span class="n">latest</span><span class="o">.</span><span class="n">pth</span> \
    <span class="n">exp</span><span class="o">/</span><span class="n">yoko</span><span class="o">/</span><span class="n">postfilter_merged</span>
</pre></div>
</div>
<p>Then, you can see the merged post-filter in the <code class="docutils literal notranslate"><span class="pre">exp/yoko/postfilter_merged</span></code> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree exp/yoko/postfilter_merged/

exp/yoko/postfilter_merged/
├── latest.pth
└── model.yaml
</pre></div>
</div>
</section>
</section>
<section id="packing-models-with-post-filter">
<h2>Packing models with post-filter<a class="headerlink" href="#packing-models-with-post-filter" title="Link to this heading"></a></h2>
<p>As the same as in <a class="reference internal" href="recipes.html"><span class="doc">Getting started with recipes</span></a>, you can pack the models into a single directory by running stage 99. Please make sure to specify the merged post-filter like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">99</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">99</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--timelag-model<span class="w"> </span>timelag_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--duration-model<span class="w"> </span>duration_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--postfilter-model<span class="w"> </span>postfilter_merged
</pre></div>
</div>
<p>The above command should make a packed model directory with your trained post-filter.</p>
</section>
<section id="how-to-use-the-packed-model-with-the-trained-post-filter">
<h2>How to use the packed model with the trained post-filter?<a class="headerlink" href="#how-to-use-the-packed-model-with-the-trained-post-filter" title="Link to this heading"></a></h2>
<p>Please specify <code class="docutils literal notranslate"><span class="pre">post_filter_type=&quot;nnsvs&quot;</span></code> with the <a class="reference internal" href="modules/svs.html"><span class="doc">nnsvs.svs</span></a> module. An example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pysinsy</span>
<span class="kn">from</span> <span class="nn">nnmnkwii.io</span> <span class="kn">import</span> <span class="n">hts</span>
<span class="kn">from</span> <span class="nn">nnsvs.pretrained</span> <span class="kn">import</span> <span class="n">retrieve_pretrained_model</span>
<span class="kn">from</span> <span class="nn">nnsvs.svs</span> <span class="kn">import</span> <span class="n">SPSVS</span>
<span class="kn">from</span> <span class="nn">nnsvs.util</span> <span class="kn">import</span> <span class="n">example_xml_file</span>

<span class="n">model_dir</span> <span class="o">=</span> <span class="s2">&quot;/path/to/your/packed/model_dir&quot;</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">SPSVS</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>

<span class="n">contexts</span> <span class="o">=</span> <span class="n">pysinsy</span><span class="o">.</span><span class="n">extract_fullcontext</span><span class="p">(</span><span class="n">example_xml_file</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;get_over&quot;</span><span class="p">))</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">hts</span><span class="o">.</span><span class="n">HTSLabelFile</span><span class="o">.</span><span class="n">create_from_contexts</span><span class="p">(</span><span class="n">contexts</span><span class="p">)</span>

<span class="n">wav</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">svs</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">post_filter_type</span><span class="o">=</span><span class="s2">&quot;nnsvs&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tips-for-training-post-filters">
<h2>Tips for training post-filters<a class="headerlink" href="#tips-for-training-post-filters" title="Link to this heading"></a></h2>
<p>If you look into the post-filter configs, you will find many parameters. Here are the tips if you want to turn by yourself:</p>
<section id="train-configs">
<h3>Train configs<a class="headerlink" href="#train-configs" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fm_weight</span></code>: The weight of the feature matching loss. By increasing the weight, you may get more stable results with a possible loss of naturalness. By setting <code class="docutils literal notranslate"><span class="pre">fm_weight</span></code> to zero, training will get unstable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">adv_weight</span></code>: The weight of the adversarial loss. By increasing the weight, you may get better naturalness.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mse_weight</span></code>: The weight of the MSE loss. If you set non-zero value, you will get smoother output features.</p></li>
</ul>
</section>
<section id="model-configs">
<h3>Model configs<a class="headerlink" href="#model-configs" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">smoothed_width</span></code>: The width of the smoothing window. If you set non-zero value, you will get smoother outputs. This is useful to reduce audible artifacts. Only used for inference.</p></li>
</ul>
</section>
</section>
<section id="details-of-post-filter-implementation">
<h2>Details of post-filter implementation<a class="headerlink" href="#details-of-post-filter-implementation" title="Link to this heading"></a></h2>
<p>You don’t need to understand the details if you just want to try, but please look into <span id="id1">Kaneko <em>et al.</em> [<a class="reference internal" href="papers.html#id42" title="Takuhiro Kaneko, Shinji Takaki, Hirokazu Kameoka, and Junichi Yamagishi. Generative adversarial network-based postfilter for stft spectrograms. In Proc. Interspeech. August 2017.">KTKY17b</a>]</span>, <span id="id2">Kaneko <em>et al.</em> [<a class="reference internal" href="papers.html#id43" title="Takuhiro Kaneko, Shinji Takaki, Hirokazu Kameoka, and Junichi Yamagishi. Generative adversarial network-based postfilter for stft spectrograms. In Proc. Interspeech, 3389–3393. 2017.">KTKY17a</a>]</span> if you are interested.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Ryuichi Yamamoto.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>