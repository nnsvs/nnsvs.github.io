<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting started with recipes &mdash; nnsvs 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=01f34227"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to choose model" href="how_to_choose_model.html" />
    <link rel="prev" title="Installation guide" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            nnsvs
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Demos</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebooks/Demos.html">NNSVS demos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started with recipes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-a-recipe">What is a recipe?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#structure-of-a-recipe">Structure of a recipe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-run-a-recipe">How to run a recipe</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-0-data-preparation">Stage 0: Data preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-1-feature-generation">Stage 1: Feature generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-2-train-time-lag-model">Stage 2: Train time-lag model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-3-train-duration-model">Stage 3: Train duration model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-4-train-acoustic-model">Stage 4: Train acoustic model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-5-generate-features">Stage 5: Generate features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stage-6-synthesis-waveforms">Stage 6: Synthesis waveforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#packing-models">Packing models</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-recipes">Customizing recipes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="how_to_choose_model.html">How to choose model</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_models.html">Defining your custom model</a></li>
<li class="toctree-l1"><a class="reference internal" href="devdocs.html">Development guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="update_guide.html">Update guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="optuna.html">Hyperparameter optimization with Optuna</a></li>
<li class="toctree-l1"><a class="reference internal" href="train_vocoders.html">How to train neural vocoders with ParallelWaveGAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="train_usfgan.html">How to train uSFGAN/SiFiGAN vocoders</a></li>
<li class="toctree-l1"><a class="reference internal" href="enunu2nnsvs.html">How to convert ENUNU models to NNSVS’ ones</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview of NNSVS’s SVS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules/base.html">nnsvs.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/model.html">nnsvs.model</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/acoustic_models.html">nnsvs.acoustic_models</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/postfilters.html">nnsvs.postfilters</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/discriminators.html">nnsvs.discriminators</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/pretrained.html">nnsvs.pretrained</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/svs.html">nnsvs.svs</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/dsp.html">nnsvs.dsp</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/gen.html">nnsvs.gen</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/io.html">nnsvs.io</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/mdn.html">nnsvs.mdn</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/pitch.html">nnsvs.pitch</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/multistream.html">nnsvs.multistream</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/util.html">nnsvs.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules/train_util.html">nnsvs.train_util</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="links.html">Useful links</a></li>
<li class="toctree-l1"><a class="reference internal" href="papers.html">Papers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Meta information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change log</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">nnsvs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Getting started with recipes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/recipes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started-with-recipes">
<h1>Getting started with recipes<a class="headerlink" href="#getting-started-with-recipes" title="Link to this heading"></a></h1>
<p>This page describes how to use a recipe to create a singing voice synthesis (SVS) system.</p>
<section id="what-is-a-recipe">
<h2>What is a recipe?<a class="headerlink" href="#what-is-a-recipe" title="Link to this heading"></a></h2>
<p>A recipe is a set of scripts and configuraitons to create SVS systems.
A recipe describes all the necessary steps including data preprocessing, training, and synthesis.</p>
<p>Recipes have been adopted for reproducibility in several research projects such as <a class="reference external" href="https://github.com/kaldi-asr/kaldi">Kaldi</a> and <a class="reference external" href="https://github.com/espnet/espnet">ESPnet</a>.
NNSVS follows a similar approach <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
</section>
<section id="structure-of-a-recipe">
<h2>Structure of a recipe<a class="headerlink" href="#structure-of-a-recipe" title="Link to this heading"></a></h2>
<p>All the recipes are stored in the <code class="docutils literal notranslate"><span class="pre">recipes</span></code> directory. Recipes are usually made per database. e.g., <code class="docutils literal notranslate"><span class="pre">recipes/nit-song070</span></code> contains recipes for nit-song070 database.</p>
<p>There are three important parts for every recipe:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">run.sh</span></code>: The entry point of the recipe.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yaml</span></code>: A YAML based config file for recipe-specific configurations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">conf</span></code>: A directory that contains detailed configurations for each model. YAML-based configuration files for time-lag/duration/acoustic models are stored in this directory.</p></li>
</ul>
<p>An example of <code class="docutils literal notranslate"><span class="pre">conf</span></code> directory is shown below. You can find model-specific configurations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>conf
├── train
│   ├── duration
│   │   ├── data
│   │   │   └── myconfig.yaml
│   │   ├── model
│   │   │   └── duration_mdn.yaml
│   │   └── train
│   │       └── myconfig.yaml
│   └── timelag
│       ├── data
│       │   └── myconfig.yaml
│       ├── model
│       │   └── timelag_mdn.yaml
│       └── train
│           └── myconfig.yaml
└── train_acoustic
    └── acoustic
        ├── data
        │   └── myconfig.yaml
        ├── model
        │   └── acoustic_resf0convlstm.yaml
        └── train
            └── myconfig.yaml
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The contents of the rest of this page is based on <code class="docutils literal notranslate"><span class="pre">recipes/conf/spsvs/run_common_steps_stable.sh</span></code>.</p>
</div>
</section>
<section id="how-to-run-a-recipe">
<h2>How to run a recipe<a class="headerlink" href="#how-to-run-a-recipe" title="Link to this heading"></a></h2>
<p>A basic workflow to run a recipe is to run the <code class="docutils literal notranslate"><span class="pre">run.sh</span></code> from the command-line as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">0</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">99</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CUDA_VISIBLE_DEVICES=0</span></code> denotes that the script uses the 0-th GPU. If you have only one GPU, you can omit the <code class="docutils literal notranslate"><span class="pre">CUDA_VISIBLE_DEVICES</span></code>.
The last <code class="docutils literal notranslate"><span class="pre">--stage</span> <span class="pre">0</span> <span class="pre">--stop-stage</span> <span class="pre">99</span></code> denotes that the script runs from stage 0 to stage 99.</p>
<p>Stage -1 is reserved for optional data downloading step. Some databases require you to sign a contract in advance. In that case, you need to manually download database.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span>-1<span class="w"> </span>--stop-stage<span class="w"> </span>-1
</pre></div>
</div>
<p>To understand what’s going on when running recipes, it is strongly recommended to run the recipe step-by-step.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are new to recipes, please start with a test recipe <code class="docutils literal notranslate"><span class="pre">nnsvs/recipes/nit-song070/dev-test</span></code>.</p>
</div>
<p>Note that every item in <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> can be customized by the command-line interface.
For example, the following command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">0</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">99</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--timelag_model<span class="w"> </span>timelag_mdn
</pre></div>
</div>
<p>is equivalent to manually changing the <code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> for the <code class="docutils literal notranslate"><span class="pre">nnsvs/recipes/nit-song070/dev-test</span></code> recipe as follows:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-timelag_model: timelag_test</span>
<span class="gi">+timelag_model: timelag_mdn</span>
</pre></div>
</div>
<p>Recipes can be arbitrary configured depending on your purpose, but the followings are some common steps for recipes.</p>
</section>
<section id="stage-0-data-preparation">
<h2>Stage 0: Data preparation<a class="headerlink" href="#stage-0-data-preparation" title="Link to this heading"></a></h2>
<p>Stage 0 for the most recipes does the following three things:</p>
<ul class="simple">
<li><p>Convert MusicXML or UST to HTS-style full-context labels.</p></li>
<li><p>Segment singing data into small segments.</p></li>
<li><p>Split the data into train/dev/test sets.</p></li>
</ul>
<p>The second step is optional but is helpful to avoid GPU out-of-memory errors.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">0</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</section>
<section id="stage-1-feature-generation">
<h2>Stage 1: Feature generation<a class="headerlink" href="#stage-1-feature-generation" title="Link to this heading"></a></h2>
<p>This step performs all the feature extraction steps needed to train time-lag/duration/acoustic models.
HTS-style full-context label files and wav files are processed together to prepare inputs/outputs for neural networks.</p>
<p>Note that errors will happen when your wav files and label files are not aligned correctly.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">1</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">1</span>
</pre></div>
</div>
<p>After running the step, you can find extracted features in <code class="docutils literal notranslate"><span class="pre">dump</span></code> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree -L 4  dump/

dump/
└── yoko
    ├── norm
    │   ├── dev
    │   │   ├── in_acoustic
    │   │   ├── in_duration
    │   │   ├── in_timelag
    │   │   ├── out_acoustic
    │   │   ├── out_duration
    │   │   └── out_timelag
    │   ├── eval
    │   │   ├── in_acoustic
    │   │   ├── in_duration
    │   │   ├── in_timelag
    │   │   ├── out_acoustic
    │   │   ├── out_duration
    │   │   └── out_timelag
    │   ├── in_acoustic_scaler.joblib
    │   ├── in_duration_scaler.joblib
    │   ├── in_timelag_scaler.joblib
    │   ├── out_acoustic_scaler.joblib
    │   ├── out_duration_scaler.joblib
    │   ├── out_timelag_scaler.joblib
    │   └── train_no_dev
    │       ├── in_acoustic
    │       ├── in_duration
    │       ├── in_timelag
    │       ├── out_acoustic
    │       ├── out_duration
    │       └── out_timelag
   └── org
   ...
</pre></div>
</div>
<p>Some notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">norm</span></code> and <code class="docutils literal notranslate"><span class="pre">org</span></code> directories contain normalized and unnormalized features. Normalized features are used for training neural networks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*_scaler.joblib</span></code> files are used to normalize/de-normalize features and contain statistics of the training data (e.g., mean and varaince). The file format follows <a class="reference external" href="https://joblib.readthedocs.io/en/latest/">joblib</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in_*</span></code> and <code class="docutils literal notranslate"><span class="pre">out_*</span></code> directories contain input and output features.</p></li>
</ul>
<p>All the features are saved in numpy format. You can inspect features by a simple python script like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;path/to/your/features.npy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="stage-2-train-time-lag-model">
<h2>Stage 2: Train time-lag model<a class="headerlink" href="#stage-2-train-time-lag-model" title="Link to this heading"></a></h2>
<p>Once the feature generation is completed, you are ready to train neural networks.</p>
<p>You can train a time-lag model by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">2</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
<p>Or, you may want to explicltly specify a model by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">2</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--timelag-model<span class="w"> </span>timelag_test
</pre></div>
</div>
<p>You can find available model configs in <code class="docutils literal notranslate"><span class="pre">conf/train/timelag/model</span></code> directory, or you can create your own model config.</p>
<p>After training is finished, you can find model checkpoints in <code class="docutils literal notranslate"><span class="pre">exp</span></code> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>exp/yoko/timelag_test/
├── best_loss.pth
├── config.yaml
├── epoch0002.pth
├── latest.pth
└── model.yaml
</pre></div>
</div>
<p>Some notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*.pth</span></code> files are the model checkpoints where the parameters of neural networks are stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.yaml</span></code> are the configuration files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model.yaml</span></code> is a model-specific config. This file can be used to instantiate a model by <a class="reference external" href="https://hydra.cc/docs/advanced/instantiate_objects/overview/">hydra</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> contains all the training details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">best_loss.pth</span></code> is the checkpoint when the model hit the best development loss.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latest.pth</span></code> is the latest checkpoint.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">epoch*.pth</span></code> are intermediate checkpoints at a specific epoch.</p></li>
</ul>
</section>
<section id="stage-3-train-duration-model">
<h2>Stage 3: Train duration model<a class="headerlink" href="#stage-3-train-duration-model" title="Link to this heading"></a></h2>
<p>Similarly, you can train a duration model by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">3</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
<p>You can explicltly specify a model type by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">3</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--duration-model<span class="w"> </span>duration_test
</pre></div>
</div>
<p>You can find available model configs in <code class="docutils literal notranslate"><span class="pre">conf/train/duration/model</span></code>.</p>
<p>After training is finished, you can find model checkpoints in <code class="docutils literal notranslate"><span class="pre">exp</span></code> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>exp/yoko/duration_test/
├── best_loss.pth
├── config.yaml
├── epoch0002.pth
├── latest.pth
└── model.yaml
</pre></div>
</div>
</section>
<section id="stage-4-train-acoustic-model">
<h2>Stage 4: Train acoustic model<a class="headerlink" href="#stage-4-train-acoustic-model" title="Link to this heading"></a></h2>
<p>The acoustic model is the most important part of the SVS system. You are likely to run this step multiple times until you get a good model.
You can train an acoustic model by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">4</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">4</span>
</pre></div>
</div>
<p>You can explicltly specify a model type by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">4</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test
</pre></div>
</div>
<p>You can find available model configs in <code class="docutils literal notranslate"><span class="pre">conf/train_acoustic/acoustic/model</span></code>, or you can create your own model config.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Training aoustic models requires several hours or a whole day depending on training configurations.
During training, it is useful to monitor training progress using Tensorboard. See <a class="reference internal" href="tips.html"><span class="doc">Tips</span></a> for more details.</p>
</div>
<p>After training is finished, you can find model checkpoints in <code class="docutils literal notranslate"><span class="pre">exp</span></code> directory.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>exp/yoko/acoustic_test/
├── best_loss.pth
├── config.yaml
├── epoch0002.pth
├── latest.pth
└── model.yaml
</pre></div>
</div>
</section>
<section id="stage-5-generate-features">
<h2>Stage 5: Generate features<a class="headerlink" href="#stage-5-generate-features" title="Link to this heading"></a></h2>
<p>One you have trained all the models, you can genearte features by your models.
You can ignore this step if you want to listen to audio samples rather than inspecting intermedieate features.</p>
<p>If you use your custom model types at the training steps, you must specify these models at this step.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">5</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--timelag-model<span class="w"> </span>timelag_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--duration-model<span class="w"> </span>duration_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test
</pre></div>
</div>
</section>
<section id="stage-6-synthesis-waveforms">
<h2>Stage 6: Synthesis waveforms<a class="headerlink" href="#stage-6-synthesis-waveforms" title="Link to this heading"></a></h2>
<p>Stage 6 generates waveforms using the trained models. To run this step, please make sure to specify your model types when you train custom models.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">5</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--timelag-model<span class="w"> </span>timelag_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--duration-model<span class="w"> </span>duration_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test
</pre></div>
</div>
<p>You can find generated wav files in <code class="docutils literal notranslate"><span class="pre">exp/${speaker</span> <span class="pre">name}/synthesis_*</span></code> directory.</p>
</section>
<section id="packing-models">
<h2>Packing models<a class="headerlink" href="#packing-models" title="Link to this heading"></a></h2>
<p>As explained in the <a class="reference internal" href="overview.html"><span class="doc">Overview of NNSVS’s SVS</span></a>, NNSVS’s SVS system is composed of multiple modules.
NNSVS provides functionality to pack the multiple models into a single directory, which can then be shared/used easily.</p>
<p>Recipes have special step at 99 for the model packaging purpose.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">99</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">99</span>
</pre></div>
</div>
<p>Note that you must specify model types if you use custom models. e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>./run.sh<span class="w"> </span>--stage<span class="w"> </span><span class="m">99</span><span class="w"> </span>--stop-stage<span class="w"> </span><span class="m">99</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--timelag-model<span class="w"> </span>timelag_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--duration-model<span class="w"> </span>duration_test<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--acoustic-model<span class="w"> </span>acoustic_test
</pre></div>
</div>
<p>After running the command above, you can find a packed model in the <code class="docutils literal notranslate"><span class="pre">packed_model</span></code> directory.</p>
<p>A packed model directory will have the following files. Note that <code class="docutils literal notranslate"><span class="pre">*postfilter_*</span></code> and <code class="docutils literal notranslate"><span class="pre">*vocoder_*</span></code> files are optional.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls -1
acoustic_model.pth
acoustic_model.yaml
config.yaml
duration_model.pth
duration_model.yaml
in_acoustic_scaler_min.npy
in_acoustic_scaler_scale.npy
in_duration_scaler_min.npy
in_duration_scaler_scale.npy
in_timelag_scaler_min.npy
in_timelag_scaler_scale.npy
in_vocoder_scaler_mean.npy
in_vocoder_scaler_scale.npy
in_vocoder_scaler_var.npy
out_acoustic_scaler_mean.npy
out_acoustic_scaler_scale.npy
out_acoustic_scaler_var.npy
out_duration_scaler_mean.npy
out_duration_scaler_scale.npy
out_duration_scaler_var.npy
out_postfilter_scaler_mean.npy
out_postfilter_scaler_scale.npy
out_postfilter_scaler_var.npy
out_timelag_scaler_mean.npy
out_timelag_scaler_scale.npy
out_timelag_scaler_var.npy
postfilter_model.pth
postfilter_model.yaml
qst.hed
timelag_model.pth
timelag_model.yaml
vocoder_model.pth
vocoder_model.yaml
</pre></div>
</div>
<p>Some notes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*.pth</span></code> files contain parameters of neural networks.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*_model.yaml</span></code> files contain definitions of neural networks such as the name of the PyTorch model (e.g., <code class="docutils literal notranslate"><span class="pre">nnsvs.model.MDN</span></code>), number of layers, number of hidden units, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*.npy</span></code> files contain parameters of scikit-learn’s scalers that are used to normalize/denormalize features.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qst.hed</span></code> is the HED file used for training models.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config.yaml</span></code> is the global config file. It specifies sampling rate for example.</p></li>
</ul>
<p>Once the packaging step is done, you can use the packaged model by the <a class="reference internal" href="modules/svs.html"><span class="doc">nnsvs.svs</span></a> module. An example of using packed models can be found at <a class="reference internal" href="notebooks/Demos.html"><span class="doc">NNSVS demos</span></a>.</p>
<p>With the packed model, you can easily generate singing voice by inputting MusicXML or UST files.</p>
</section>
<section id="customizing-recipes">
<h2>Customizing recipes<a class="headerlink" href="#customizing-recipes" title="Link to this heading"></a></h2>
<p>Not just running existing recipes, you may want to make your own ones. e.g., adding your custom models, customizing steps, using your own data, etc.</p>
<p>If you want to make your own recipe, the easiest way is to copy an existing recipe and modify it accordingly.
Please check one of recipes in the NNSVS repostiry and start modifying part of them.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Recipes in NNSVS and Kaldi are technically different. For example, NNSVS does’t use <code class="docutils literal notranslate"><span class="pre">text</span></code>, <code class="docutils literal notranslate"><span class="pre">feats.scp</span></code>, <code class="docutils literal notranslate"><span class="pre">wav.scp</span></code> and <code class="docutils literal notranslate"><span class="pre">segments</span></code> that are traditionally used in Kaldi.</p>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="how_to_choose_model.html" class="btn btn-neutral float-right" title="How to choose model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Ryuichi Yamamoto.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>